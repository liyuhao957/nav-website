<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC</title>
    <!-- 添加网站图标 -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- 添加 Sortable.js -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 
                Roboto, Oxygen-Sans, Ubuntu, Cantarell, 
                'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #2c3e50;
            line-height: 1.5;
            text-rendering: optimizeLegibility;
        }

        /* 确保所有文本元素使用相同的字体设置 */
        input, button, select, textarea {
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
        }

        /* 统一不同系统下的文本渲染 */
        .link-title, .link-description, .section-title {
            font-weight: 500;  /* 使用数字而不是 'bold' */
            letter-spacing: -0.01em;  /* 细微调整字母间距 */
        }

        /* 确保按钮在不同系统下的一致性 */
        button {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            margin: 0;
        }

        /* 主要内容区域布局 */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin: 0;
            padding: 0 0 0 30px;
        }

        /* 搜索区域样式 */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 0;
            box-shadow: none;
            margin-bottom: 0;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            min-width: 0;
        }

        .search-options {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .radio-group {
            display: flex;
            gap: 10px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 4px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .radio-label:hover {
            background: #e9ecef;
        }

        .search-button {
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-button:hover {
            background: #0056b3;
        }

        /* 链接列表区域样式 */
        .links-section {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-bottom: 2px solid #f0f0f0;
            margin: 0;
            position: sticky;
            top: 84px;  /* 搜索框的高度 + padding */
            z-index: 99;
        }

        .section-title {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 600;
            margin: 0;
            padding-left: 10px;
        }

        /* 分类筛选器样式 */
        .category-filter {
            position: relative;
            width: 200px;
        }

        .category-filter select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            color: #2c3e50;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 45px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
            padding-right: 45px;
        }

        .category-filter select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .category-filter select:hover {
            border-color: #007bff;
        }

        /* 重置默认样式 */
        .category-filter select::-ms-expand {
            display: none;
        }

        /* 美化下拉选项 */
        .category-filter select option {
            padding: 12px 15px;
            font-size: 14px;
            color: #2c3e50;
            background-color: white;
            border: none;
        }

        /* 选项悬停和选中状态 */
        .category-filter select option:hover,
        .category-filter select option:focus {
            background-color: #007bff;
            color: white;
        }

        .category-filter select option:checked {
            background: linear-gradient(0deg, #007bff 0%, #007bff 100%);
            color: white;
            font-weight: 500;
        }

        /* 禁用状态 */
        .category-filter select:disabled {
            background-color: #f8f9fa;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .category-filter select option:disabled {
            color: #999;
            background-color: #f8f9fa;
        }

        /* 添加选择框的激活状态效果 */
        .category-filter::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            pointer-events: none;
        }

        /* 自定义滚动条 */
        .category-filter select {
            scrollbar-width: thin;
            scrollbar-color: #007bff #f0f0f0;
        }

        .category-filter select::-webkit-scrollbar {
            width: 8px;
        }

        .category-filter select::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        .category-filter select::-webkit-scrollbar-thumb {
            background-color: #007bff;
            border-radius: 4px;
            border: 2px solid #f0f0f0;
        }

        .category-filter select::-webkit-scrollbar-thumb:hover {
            background-color: #0056b3;
        }

        /* 适配深色模式 */
        @media (prefers-color-scheme: dark) {
            .category-filter select {
                background-color: #2c3e50;
                color: white;
                border-color: #4a5568;
            }
            
            .category-filter select option {
                background-color: #2c3e50;
                color: white;
            }
            
            .category-filter select option:checked {
                background: linear-gradient(0deg, #007bff 0%, #007bff 100%);
            }
        }

        /* 添加动画效果 */
        .category-filter select {
            transform-origin: top;
            transition: all 0.2s ease;
        }

        .category-filter select:focus {
            transform: scale(1.01);
        }

        /* 链接列表样式 */
        .links-container {
            margin-top: 20px;
        }

        .category-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .category-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            cursor: move; /* 添加移动光标 */
            user-select: none; /* 防止文本被选中 */
        }

        .category-title span {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 600;
        }

        .category-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            height: 100%;
        }

        .links-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 10px;
        }

        .link-item {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            width: fit-content;  /* 根据内容自适应宽度 */
            min-width: 150px;  /* 最小宽度 */
        }

        .link-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .link-content {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            width: fit-content;  /* 根据内容自适应宽度 */
        }

        .link-favicon {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .link-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .link-title {
            color: #2c3e50;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 5px;
            white-space: nowrap;  /* 保持在一行 */
            width: fit-content;  /* 根据内容自适应宽度 */
        }

        .link-description {
            color: #6c757d;
            font-size: 14px;
            white-space: nowrap;  /* 保持在一行 */
            width: fit-content;  /* 根据内容自适应宽度 */
        }

        .link-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
            width: 100%;  /* 按钮容器占满卡片宽度 */
        }

        .edit-button,
        .delete-button {
            width: 60px;
            padding: 6px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .edit-button {
            background: #4CAF50;
            color: white;
        }

        .edit-button:hover {
            background: #45a049;
        }

        .delete-button {
            background: #ff4444;
            color: white;
        }

        .delete-button:hover {
            background: #ff1111;
        }

        /* 工具栏区域样式 */
        .tools-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .section-title {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .category-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .category-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .add-button,
        .add-link-button {
            width: 120px;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto;
            display: block;
        }

        .add-button:hover,
        .add-link-button:hover {
            background: #0056b3;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-button {
            padding: 12px;
            background: #f8f9fa;
            color: #2c3e50;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            background: #e9ecef;
            border-color: #007bff;
        }

        /* Toast提示样式 */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            padding: 12px 24px;
            border-radius: 8px;
            margin: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease forwards;
            font-size: 16px;
            font-weight: 500;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.info {
            background: #007bff;
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            to {
                transform: translateY(100%);
                opacity: 0;
            }
        }

        /* 侧边栏导航样式 */
        .category-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .category-nav-item {
            margin-bottom: 10px;
        }

        .category-nav-header {
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .category-nav-header:hover {
            background: #e9ecef;
        }

        .category-nav-header.active {
            background: #007bff !important;
            color: white !important;
        }

        .category-nav-toggle {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .category-nav-toggle.expanded {
            transform: rotate(90deg);
        }

        .category-nav-links {
            display: none;
            padding: 8px 15px;
        }

        .category-nav-links.expanded {
            display: block;
        }

        .category-nav-link {
            display: block;
            padding: 8px 15px;
            margin: 5px 0;
            color: #2c3e50;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .category-nav-link:hover {
            background: #f8f9fa;
            color: #007bff;
        }

        .category-nav-divider {
            height: 1px;
            background: #e1e8ed;
            margin: 15px 0;
        }

        /* 侧边栏样式 */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 250px;
            background: white;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            padding: 0;
            overflow-y: auto;
            z-index: 1000;
            transform: translateX(0);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .nav-links {
            padding: 15px;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            gap: 10px;
            order: -1;  /* 将导航链接移到顶部 */
        }

        .nav-links a {
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            color: #2c3e50;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .nav-links a:hover {
            background: #f8f9fa;
        }

        .nav-links a.active {
            background: #007bff;
            color: white;
        }

        .category-nav {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            margin: 0;
        }

        .sidebar-toggle {
            position: absolute;
            right: -40px;
            top: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 0 5px 5px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-toggle i {
            border: solid #2c3e50;
            border-width: 0 2px 2px 0;
            display: inline-block;
            padding: 4px;
            transition: transform 0.3s ease;
        }

        /* 主要内容区域样式 */
        .main-wrapper {
            margin-left: 250px;
            padding: 0;
            transition: margin-left 0.3s ease;
        }

        .sidebar-collapsed .main-wrapper {
            margin-left: 0;
        }

        /* 标题样式 */
        h1 {
            font-size: 36px;
            color: #2c3e50;
            text-align: center;
            margin: 15px 0;
            font-weight: 700;
        }

        /* 空状态提示 */
        .empty-message {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }

        /* 编辑对话框样式 */
        .edit-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .edit-dialog {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .edit-dialog-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .edit-form-group {
            margin-bottom: 15px;
        }

        .edit-form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .edit-form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .edit-form-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .edit-dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .edit-dialog-button {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .edit-dialog-cancel {
            background: #f8f9fa;
            color: #2c3e50;
        }

        .edit-dialog-cancel:hover {
            background: #e9ecef;
        }

        .edit-dialog-confirm {
            background: #007bff;
            color: white;
        }

        .edit-dialog-confirm:hover {
            background: #0056b3;
        }

        /* 工具栏区域样式 */
        .tools-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .category-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .category-actions {
            display: flex;
            gap: 10px;
        }

        .category-edit-button,
        .category-delete-button {
            width: 60px;
            padding: 6px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
        }

        .category-edit-button {
            background: #4CAF50;
        }

        .category-edit-button:hover {
            background: #45a049;
        }

        .category-delete-button {
            background: #ff4444;
        }

        .category-delete-button:hover {
            background: #ff1111;
        }

        .links-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
        }

        .search-container {
            background: white;
            padding: 20px;
            border-radius: 0;
            box-shadow: none;
            margin-bottom: 0;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-bottom: 2px solid #f0f0f0;
            margin: 0;
            position: sticky;
            top: 84px;  /* 搜索框的高度 + padding */
            z-index: 99;
        }

        /* 添加一个小阴影效果，让固定头部更加明显 */
        .links-header {
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .sort-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
        }

        .sort-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            background: #f8f9fa;
        }

        .sort-button:hover {
            background: #e9ecef;
        }

        .sort-button.desc .sort-icon {
            transform: rotate(180deg);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .category-ghost {
            opacity: 0.5;
            background: #f8f9fa;
        }

        .category-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.15s ease;
        }

        .categories-container {
            margin-top: 20px;
        }

        /* 自定义确认对话框样式 */
        .confirm-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .confirm-dialog {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(0);
            animation: slideIn 0.3s ease;
        }

        .confirm-dialog-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .confirm-dialog-content {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .confirm-dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .confirm-dialog-button {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .confirm-dialog-cancel {
            background: #f7fafc;
            color: #4a5568;
        }

        .confirm-dialog-cancel:hover {
            background: #edf2f7;
        }

        .confirm-dialog-confirm {
            background: #3182ce;
            color: white;
        }

        .confirm-dialog-confirm:hover {
            background: #2c5282;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* 自定义下拉框样式 */
        .custom-select {
            position: relative;
            width: 200px;
            user-select: none;
        }

        .selected-option {
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            color: #2c3e50;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            padding-right: 45px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .selected-option::after {
            content: '';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            transition: transform 0.3s ease;
        }

        .custom-select.open .selected-option::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .custom-select.open .dropdown-menu {
            display: block;
            animation: dropdownFadeIn 0.2s ease;
        }

        .dropdown-item {
            padding: 12px 15px;
            font-size: 14px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
            color: #007bff;
        }

        .dropdown-item.selected {
            background-color: #007bff;
            color: white;
        }

        /* 自定义滚动条 */
        .dropdown-menu::-webkit-scrollbar {
            width: 8px;
        }

        .dropdown-menu::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .dropdown-menu::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .dropdown-menu::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .link-form .custom-select {
            width: 100%;
        }

        .link-form .selected-option {
            width: 100%;
            box-sizing: border-box;
        }

        .link-form .dropdown-menu {
            width: 100%;
            box-sizing: border-box;
        }

        /* 笔记相关样式 */
        .notes-container {
            display: none;
            padding: 20px;
        }

        .notes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
            padding: 10px;
            align-items: start;  /* 让卡片从顶部对齐 */
        }

        .note-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            width: 100%;
            height: fit-content;  /* 根据内容自适应高度 */
            min-height: 120px;    /* 设置一个较小的最小高度 */
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
        }

        .note-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }

        .note-card h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
            line-height: 1.4;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .note-card .note-content {
            color: #4a5568;
            margin: 0;
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 15px;
            padding: 0;
            height: auto;
            max-height: 500px;    /* 设置最大高度，超出显示滚动条 */
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }

        /* 当内容较短时的样式 */
        .note-card.short-content {
            min-height: 120px;
        }

        /* 当内容较长时的样式 */
        .note-card.long-content {
            height: auto;
        }

        .note-card .note-tags {
            color: #4299e1;
            font-size: 0.9em;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .note-card .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .note-card .note-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .note-card .edit-note {
            background: #38a169;
            color: white;
        }

        .note-card .edit-note:hover {
            background: #2f855a;
        }

        .note-card .delete-note {
            background: #e53e3e;
            color: white;
        }

        .note-card .delete-note:hover {
            background: #c53030;
        }

        @keyframes highlight {
            0% {
                background-color: #fff7e6;
                transform: scale(1.02);
            }
            50% {
                background-color: #fff7e6;
                transform: scale(1.02);
            }
            100% {
                background-color: white;
                transform: scale(1);
            }
        }

        .note-card[data-note-id] {
            transition: all 0.3s ease;
        }

        .note-card .note-tags {
            color: #007bff;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .highlighted-tag {
            background-color: #007bff;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin: 2px;
        }

        /* 添加标签搜索相关的样式 */
        .search-options {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 15px;
        }

        .radio-group {
            display: flex;
            gap: 10px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 4px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .radio-label:hover {
            background: #e9ecef;
        }

        .radio-label input[type="radio"] {
            margin: 0;
        }

        .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .note-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-note {
            background: #28a745;
            color: white;
        }

        .delete-note {
            background: #dc3545;
            color: white;
        }

        .note-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .note-form textarea {
            width: 100%;
            min-height: 100px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }

        .note-form input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .note-form button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .note-form button:hover {
            background: #0056b3;
        }

        /* 添加新的样式 */
        .main-content {
            flex: 1;
        }

        .notes-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
        }

        .tool-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .add-note-button {
            width: 100%;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-note-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <!-- 添加确认对话框HTML结构 -->
    <div id="confirmDialog" class="confirm-dialog-overlay" style="display: none;">
        <div class="confirm-dialog">
            <div class="confirm-dialog-title">确认删除</div>
            <div class="confirm-dialog-content"></div>
            <div class="confirm-dialog-buttons">
                <button class="confirm-dialog-button confirm-dialog-cancel" onclick="closeConfirmDialog()">取消</button>
                <button class="confirm-dialog-button confirm-dialog-confirm" onclick="handleConfirm()">确定</button>
            </div>
        </div>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-toggle" onclick="toggleSidebar()">
            <i></i>
        </div>
        <div class="nav-links">
            <a href="#" class="active" onclick="showLinks()">链接</a>
            <a href="#" onclick="showNotes()">笔记</a>
        </div>
        <ul class="category-nav" id="categoryNav">
            <!-- 分类导航将通过 JavaScript 动态生成 -->
        </ul>
    </div>

    <div class="main-wrapper">
        <h1>TC</h1>

        <!-- 主要内容区域 -->
        <div class="content-grid">
            <!-- 左侧内容区域 -->
            <div class="main-content">
                <!-- 链接管理界面 -->
                <div id="linksContainer" class="links-section">
                <div class="links-header">
                    <div class="search-container">
                            <input type="text" class="search-input" id="searchInput" placeholder="搜索链接...">
                        <div class="search-options">
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="search-engine" value="baidu" checked>
                                    百度
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="search-engine" value="google">
                                    谷歌
                                </label>
                            </div>
                        </div>
                        <button class="search-button" onclick="searchLinks()">搜索</button>
                    </div>
                </div>
                <div class="section-header">
                    <h2 class="section-title">链接列表</h2>
                    <div class="header-controls">
                        <button class="sort-button" onclick="toggleCategorySort()">
                            <span class="sort-icon">↓</span>
                        </button>
                        <div class="category-filter">
                                <div class="custom-select" onclick="toggleDropdown(event)">
                                    <div class="selected-option">显示所有分类</div>
                                    <div class="dropdown-menu">
                                        <div class="dropdown-item selected" data-value="all">显示所有分类</div>
                        </div>
                    </div>
                </div>
                        </div>
                    </div>
                    <div class="links-container">
                    <!-- 链接列表将通过 JavaScript 动态生成 -->
                    </div>
                </div>

                <!-- 笔记管理界面 -->
                <div id="notesContainer" class="notes-section" style="display: none;">
                    <div class="notes-header">
                        <div class="search-container">
                            <input type="text" class="search-input" id="noteSearchInput" placeholder="搜索笔记内容...">
                            <div class="search-options">
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="search-type" value="content" checked>
                                        内容
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="search-type" value="tag">
                                        标签
                                    </label>
                                </div>
                            </div>
                            <button class="search-button" onclick="searchNotes()">搜索</button>
                        </div>
                    </div>
                    <div class="section-header">
                        <h2 class="section-title">笔记列表</h2>
                    </div>
                    <div class="notes-list" id="notesList">
                        <!-- 笔记列表将通过JavaScript动态添加 -->
                    </div>
                </div>
            </div>

            <!-- 右侧工具栏 -->
            <div class="tools-section">
                <!-- 链接管理工具 -->
                <div id="linkTools" class="tool-container">
                <!-- 添加分类 -->
                <div class="section">
                    <h2 class="section-title">添加新分类</h2>
                    <div class="category-form">
                        <input type="text" class="category-input" id="categoryInput" placeholder="请输入分类名称...">
                        <button class="add-button" onclick="categoryManager.addCategory()">创建分类</button>
                    </div>
                </div>

                <!-- 添加链接 -->
                <div class="section">
                    <h2 class="section-title">添加新链接</h2>
                    <div class="link-form">
                        <div class="form-group">
                            <label>选择分类</label>
                                <div class="custom-select" onclick="toggleDropdown(event)">
                                    <div class="selected-option">请选择分类...</div>
                                    <div class="dropdown-menu">
                                        <!-- 分类选项将通过JavaScript动态添加 -->
                                    </div>
                                </div>
                        </div>
                        <div class="form-group">
                            <label for="titleInput">网站名称</label>
                            <input type="text" id="titleInput" class="title-input" placeholder="请输入网站名称...">
                        </div>
                        <div class="form-group">
                            <label for="urlInput">网站地址</label>
                            <input type="url" id="urlInput" class="url-input" placeholder="请输入网站地址...">
                        </div>
                        <div class="form-group">
                            <label for="descriptionInput">简短描述</label>
                            <input type="text" id="descriptionInput" class="description-input" placeholder="请输入简短描述...">
                        </div>
                        <button class="add-link-button" onclick="linkManager.addLink()">添加链接</button>
                    </div>
                </div>

                <!-- 工具箱 -->
                <div class="section">
                    <h2 class="section-title">工具箱</h2>
                    <div class="action-buttons">
                            <button class="action-button" onclick="exportTemplate()">导入示例</button>
                        <button class="action-button" onclick="importLinks()">导入链接</button>
                        <button class="action-button" onclick="exportLinks()">导出链接</button>
                        <button class="action-button" onclick="checkLinks()">检查链接</button>
                    </div>
                </div>
            </div>

                <!-- 笔记管理工具 -->
                <div id="noteTools" class="tool-container" style="display: none;">
                    <!-- 添加笔记 -->
                    <div class="section">
                        <h2 class="section-title">添加新笔记</h2>
                        <div class="note-form">
                            <div class="form-group">
                                <label for="noteTitle">笔记标题</label>
                                <input type="text" id="noteTitle" placeholder="请输入标题...">
                            </div>
                            <div class="form-group">
                                <label for="noteContent">笔记内容</label>
                                <textarea id="noteContent" placeholder="请输入内容..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="noteTags">标签</label>
                                <input type="text" id="noteTags" placeholder="用逗号分隔多个标签...">
                            </div>
                            <button class="add-note-button" onclick="noteManager.addNote()">添加笔记</button>
                        </div>
                    </div>

                    <!-- 笔记工具箱 -->
                    <div class="section">
                        <h2 class="section-title">笔记工具</h2>
                        <div class="action-buttons">
                            <button class="action-button" onclick="noteManager.exportNotes()">导出笔记</button>
                            <button class="action-button" onclick="noteManager.importNotes()">导入笔记</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast 容器 -->
    <div class="toast-container"></div>

    <script>
        // 定义全局baseUrl
        const baseUrl = 'http://localhost:3000';

        // 添加全局变量
        let currentExpandedCategory = null;
        let isCategoryDescSort = true; // 默认降序（最新创建的在前）

        // 添加滚动到顶部的辅助函数
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // 默认图标的base64编码
        const defaultFavicon = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM2YzZjNmMiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIvPjwvc3ZnPg==';

        // 记录访问次数
        async function recordVisit(linkId) {
            try {
                await fetch(`${baseUrl}/api/links/${linkId}/visit`, { method: 'POST' });
            } catch (error) {
                console.error('记录访问失败:', error);
            }
        }

        // 删除链接
        async function deleteLink(linkId) {
            showConfirmDialog('确定要删除这个链接吗？', async () => {
            try {
                    const response = await fetch(`${baseUrl}/api/links/${encodeURIComponent(linkId)}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('删除链接失败');
                }

                    // 重新加载分类和导航栏
                    await loadCategories();
                    await updateSidebarNav();
                    
                    // 切换到"显示所有分类"视图
                    const allCategoriesHeader = document.querySelector('#categoryNav li:first-child .category-nav-header');
                    if (allCategoriesHeader) {
                        allCategoriesHeader.click();
                    }
                    
                showToast('链接删除成功！');
            } catch (error) {
                console.error('删除链接失败:', error);
                showToast('删除链接失败: ' + error.message, 'error');
            }
            });
        }

        // 搜索功能
        function searchLinks() {
            const query = document.querySelector('.search-input').value;
            const engine = document.querySelector('input[name="search-engine"]:checked').value;
            const baseUrl = engine === 'baidu' ? 'https://www.baidu.com/s?wd=' : 'https://www.google.com/search?q=';
            window.open(baseUrl + encodeURIComponent(query), '_blank');
        }

        // Toast 提示函数
        function showToast(message, type = 'success') {
            const toastContainer = document.querySelector('.toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => toastContainer.removeChild(toast), 300);
            }, 3000);
        }

        // 工具函数
        const utils = {
            showToast(message, type = 'success') {
                showToast(message, type);
            },

            async fetchAPI(url, options = {}) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error('API请求失败:', error);
                    this.showToast(error.message, 'error');
                    throw error;
                }
            }
        };

        // 链接管理
        const linkManager = {
            isSubmitting: false, // 添加提交状态标记

            async addLink() {
                // 如果正在提交中，直接返回
                if (this.isSubmitting) {
                    showToast('正在提交中，请稍候...', 'info');
                    return;
                }

                const selectedOption = document.querySelector('.link-form .selected-option');
                const category = selectedOption.getAttribute('data-value');
                const title = document.getElementById('titleInput').value.trim();
                const url = document.getElementById('urlInput').value.trim();
                const description = document.getElementById('descriptionInput').value.trim();

                if (!this.validateLinkInput(category, title, url)) return;

                try {
                    // 设置提交状态为true
                    this.isSubmitting = true;
                    // 禁用添加按钮
                    const addButton = document.querySelector('.add-link-button');
                    addButton.disabled = true;
                    addButton.style.backgroundColor = '#ccc';
                    addButton.style.cursor = 'not-allowed';
                    // 显示提交中的提示
                    showToast('正在添加链接，请稍候...', 'info');

                    await utils.fetchAPI(`${baseUrl}/api/links`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ category, title, url, description })
                    });

                    this.clearLinkForm();
                    await loadLinks(category);
                    utils.showToast('链接添加成功！');
                } catch (error) {
                    utils.showToast('添加链接失败: ' + error.message, 'error');
                } finally {
                    // 重置提交状态
                    this.isSubmitting = false;
                    // 恢复添加按钮
                    const addButton = document.querySelector('.add-link-button');
                    addButton.disabled = false;
                    addButton.style.backgroundColor = '';
                    addButton.style.cursor = 'pointer';
                }
            },

            validateLinkInput(category, title, url) {
                if (!category) {
                    utils.showToast('请选择分类', 'error');
                    return false;
                }
                if (!title) {
                    utils.showToast('请输入网站名称', 'error');
                    return false;
                }
                if (!url) {
                    utils.showToast('请输入网站地址', 'error');
                    return false;
                }
                return true;
            },

            clearLinkForm() {
                const selectedOption = document.querySelector('.link-form .selected-option');
                selectedOption.textContent = '请选择分类...';
                selectedOption.removeAttribute('data-value');
                document.getElementById('titleInput').value = '';
                document.getElementById('urlInput').value = '';
                document.getElementById('descriptionInput').value = '';
            }
        };

        // 分类管理
        const categoryManager = {
            isSubmitting: false, // 添加提交状态标记

            async addCategory() {
                // 如果正在提交中，直接返回
                if (this.isSubmitting) {
                    showToast('正在创建分类，请稍候...', 'info');
                    return;
                }

                const categoryInput = document.getElementById('categoryInput');
                const category = categoryInput.value.trim();
                
                if (!category) {
                    utils.showToast('请输入分类名称', 'error');
                    return;
                }

                try {
                    // 设置提交状态为true
                    this.isSubmitting = true;
                    // 禁用添加按钮
                    const addButton = document.querySelector('.add-button');
                    addButton.disabled = true;
                    addButton.style.backgroundColor = '#ccc';
                    addButton.style.cursor = 'not-allowed';
                    // 显示提交中的提示
                    showToast('正在创建分类，请稍候...', 'info');

                    await utils.fetchAPI(`${baseUrl}/api/categories`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ category })
                    });

                    categoryInput.value = '';
                    await this.refreshCategories();
                    utils.showToast('分类创建成功！');
                } catch (error) {
                    utils.showToast('添加分类失败: ' + error.message, 'error');
                } finally {
                    // 重置提交状态
                    this.isSubmitting = false;
                    // 恢复添加按钮
                    const addButton = document.querySelector('.add-button');
                    addButton.disabled = false;
                    addButton.style.backgroundColor = '';
                    addButton.style.cursor = 'pointer';
                }
            },

            async refreshCategories() {
                await loadCategories();
                await updateSidebarNav();
            }
        };

        // 更新分类过滤器变化处理函数
        function handleCategoryFilterChange(category) {
            console.log('分类选择器变化:', category);
            if (category === 'all') {
                // 点击"显示所有分类"
                const allCategoriesHeader = document.querySelector('#categoryNav li:first-child .category-nav-header');
                if (allCategoriesHeader) {
                    allCategoriesHeader.click();
                }
            } else {
                // 找到对应的分类并点击
                const categoryHeader = Array.from(document.querySelectorAll('.category-name'))
                    .find(span => span.textContent === category)
                    ?.closest('.category-nav-header');
                if (categoryHeader) {
                    categoryHeader.click();
                }
            }
            scrollToTop();
        }

        // 切换分类排序
        function toggleCategorySort() {
            isCategoryDescSort = !isCategoryDescSort;
            const sortButton = document.querySelector('.sort-button');
            if (sortButton) {
                sortButton.classList.toggle('desc', isCategoryDescSort);
            }
            // 保存当前展开的分类
            const expandedCategory = currentExpandedCategory;
            reloadCategoriesWithSort(expandedCategory);
            scrollToTop();
        }

        // 更新分类重新加载函数
        async function reloadCategoriesWithSort(expandedCategory = null) {
            try {
                console.log('开始重新加载分类...');
                console.log('当前排序方向:', isCategoryDescSort ? 'desc' : 'asc');
                
                const response = await fetch(`${baseUrl}/api/categories?sort=${isCategoryDescSort ? 'desc' : 'asc'}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const categories = await response.json();
                
                // 保存当前选中的分类
                const currentSelectedCategory = document.querySelector('.category-nav-header.active .category-name')?.textContent;
                
                await updateSidebarNav();
                
                // 如果有展开的分类，重新展开它
                if (expandedCategory) {
                    const categoryElement = Array.from(document.querySelectorAll('.category-name'))
                        .find(span => span.textContent === expandedCategory)
                        ?.closest('.category-nav-item');
                    
                    if (categoryElement) {
                        const header = categoryElement.querySelector('.category-nav-header');
                        const toggle = categoryElement.querySelector('.category-nav-toggle');
                        const links = categoryElement.querySelector('.category-nav-links');
                        
                        toggle.classList.add('expanded');
                        links.classList.add('expanded');
                        currentExpandedCategory = expandedCategory;
                        
                        // 重新加载该分类的链接
                        const linksResponse = await fetch(`${baseUrl}/api/links/${encodeURIComponent(expandedCategory)}`);
                        if (linksResponse.ok) {
                            const categoryLinks = await linksResponse.json();
                            links.innerHTML = categoryLinks.map(link => `
                                <a href="${link.url}" class="category-nav-link" target="_blank" title="${link.description || ''}">
                                    ${link.title}
                                </a>
                            `).join('');
                        }
                    }
                }
                
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {
                    const currentValue = categoryFilter.value;
                    categoryFilter.innerHTML = '<option value="all">显示所有分类</option>';
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categoryFilter.appendChild(option);
                    });
                    categoryFilter.value = currentValue;
                }
                
                const categorySelect = document.getElementById('categorySelect');
                if (categorySelect) {
                    const currentValue = categorySelect.value;
                    categorySelect.innerHTML = '<option value="" disabled selected>请选择分类...</option>';
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                    if (currentValue) categorySelect.value = currentValue;
                }
                
                const currentCategory = categoryFilter ? categoryFilter.value : 'all';
                await loadLinks(currentCategory);
                
                // 恢复选中状态
                if (currentSelectedCategory) {
                    const categoryHeader = Array.from(document.querySelectorAll('.category-name'))
                        .find(span => span.textContent === currentSelectedCategory)
                        ?.closest('.category-nav-header');
                    if (categoryHeader) {
                        categoryHeader.classList.add('active');
                    }
                }
                
                showToast(`分类已${isCategoryDescSort ? '降序' : '升序'}排列`);
            } catch (error) {
                console.error('重新加载分类失败:', error);
                showToast('重新加载分类失败: ' + error.message, 'error');
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadCategories();
                await updateSidebarNav();
                // 确保默认显示链接管理界面
                showLinks();
                // 默认选中"全部分类"
                const allCategoriesHeader = Array.from(document.querySelectorAll('#categoryNav .category-nav-header'))
                    .find(header => header.textContent.includes('全部分类'));
                if (allCategoriesHeader) {
                    allCategoriesHeader.classList.add('active');
                    // 触发点击事件以确保状态一致
                    await filterLinksByCategory('all');
                }
                console.log('初始化完成');
            } catch (error) {
                console.error('初始化失败:', error);
                alert('初始化失败: ' + error.message);
            }
        });

        // 加载分类列表
        async function loadCategories() {
            try {
                console.log('开始加载分类...');
                console.log('当前排序方向:', isCategoryDescSort ? 'desc' : 'asc');
                const response = await fetch(`${baseUrl}/api/categories?sort=${isCategoryDescSort ? 'desc' : 'asc'}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const categories = await response.json();
                
                // 更新分类筛选器的下拉框
                const filterDropdownMenu = document.querySelector('.category-filter .dropdown-menu');
                filterDropdownMenu.innerHTML = `<div class="dropdown-item selected" data-value="all">显示所有分类</div>`;
                    categories.forEach(category => {
                    filterDropdownMenu.innerHTML += `
                        <div class="dropdown-item" data-value="${category}">${category}</div>
                    `;
                });
                
                // 更新添加链接表单的下拉框
                const addLinkDropdownMenu = document.querySelector('.link-form .dropdown-menu');
                addLinkDropdownMenu.innerHTML = '';
                    categories.forEach(category => {
                    addLinkDropdownMenu.innerHTML += `
                        <div class="dropdown-item" data-value="${category}">${category}</div>
                    `;
                });
                
                // 添加点击事件
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.querySelectorAll('.dropdown-item').forEach(item => {
                        item.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const value = e.target.dataset.value;
                            const selectedText = e.target.textContent;
                            const customSelect = e.target.closest('.custom-select');
                            const selectedOption = customSelect.querySelector('.selected-option');
                            
                            // 更新选中状态
                            menu.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('selected'));
                            e.target.classList.add('selected');
                            
                            // 更新显示文本和值
                            selectedOption.textContent = selectedText;
                            selectedOption.setAttribute('data-value', value);
                            
                            // 如果是分类筛选器，触发分类切换
                            if (customSelect.closest('.category-filter')) {
                                handleCategoryFilterChange(value);
                            }
                            
                            // 关闭下拉框
                            customSelect.classList.remove('open');
                        });
                    });
                });

                await loadLinks('all');
            } catch (error) {
                console.error('加载分类失败:', error);
                showToast('加载分类失败，请确保后端服务器已启动', 'error');
            }
        }

        // 根据分类筛选链接
        async function filterLinksByCategory(category) {
            try {
                console.log('筛选分类:', category);
                const nav = document.getElementById('categoryNav');
                if (nav) {
                    // 移除其他项的active类，但保持"全部分类"的状态
                    nav.querySelectorAll('.category-nav-header').forEach(header => {
                        const isAllCategories = header.textContent.includes('全部分类');
                        if (category === 'all' && isAllCategories) {
                            header.classList.add('active');
                        } else if (category !== 'all' && !isAllCategories) {
                            const categoryName = header.querySelector('.category-name')?.textContent;
                            if (categoryName === category) {
                                header.classList.add('active');
                    } else {
                                header.classList.remove('active');
                            }
                        }
                    });
                }
                
                const linksContainer = document.querySelector('.links-container');
                linksContainer.innerHTML = '';
                
                if (category === 'all') {
                    // 获取所有分类
                    const categoriesResponse = await fetch(`${baseUrl}/api/categories?sort=${isCategoryDescSort ? 'desc' : 'asc'}`);
                    const categories = await categoriesResponse.json();
                    
                    // 为每个分类获取链接
                    for (const cat of categories) {
                        const response = await fetch(`${baseUrl}/api/links/${encodeURIComponent(cat)}`);
                        if (!response.ok) continue;
                        
                        const links = await response.json();
                        if (links.length === 0) continue;
                        
                            const categorySection = document.createElement('div');
                            categorySection.className = 'category-section';
                            categorySection.setAttribute('data-category', cat);
                            categorySection.innerHTML = `
                                <h3 class="category-title">
                                    <span>${cat}</span>
                                    <div class="category-actions">
                                        <button class="category-edit-button" onclick="editCategory('${cat}')">编辑</button>
                                        <button class="category-delete-button" onclick="deleteCategory('${cat}')">删除</button>
                                    </div>
                                </h3>
                            `;
                            
                            const linksList = document.createElement('div');
                            linksList.className = 'links-list';
                        links.forEach(link => {
                                linksList.appendChild(createLinkItem(link));
                            });
                            
                            categorySection.appendChild(linksList);
                        linksContainer.appendChild(categorySection);
                    }
                } else {
                    const response = await fetch(`${baseUrl}/api/links/${encodeURIComponent(category)}`);
                    if (!response.ok) {
                        throw new Error('加载链接失败');
                    }
                    const links = await response.json();
                    
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category-section';
                    categorySection.innerHTML = `
                        <h3 class="category-title">
                            <span>${category}</span>
                            <div class="category-actions">
                                <button class="category-edit-button" onclick="editCategory('${category}')">编辑</button>
                                <button class="category-delete-button" onclick="deleteCategory('${category}')">删除</button>
                            </div>
                        </h3>
                    `;
                    
                    const linksList = document.createElement('div');
                    linksList.className = 'links-list';
                    links.forEach(link => {
                        linksList.appendChild(createLinkItem(link));
                    });
                    
                    categorySection.appendChild(linksList);
                    linksContainer.appendChild(categorySection);
                }
            } catch (error) {
                console.error('筛选链接失败:', error);
                showToast('筛选链接失败: ' + error.message, 'error');
            }
        }

        // 创建链接项
        function createLinkItem(link) {
            const linkItem = document.createElement('div');
            linkItem.className = 'link-item';
            linkItem.innerHTML = `
                <div class="link-content">
                    <img src="${link.favicon || defaultFavicon}" class="link-favicon" alt="favicon" onerror="this.src='${defaultFavicon}'">
                    <div class="link-info">
                        <a href="${link.url}" target="_blank" class="link-title" onclick="recordVisit('${link.id}')">${link.title}</a>
                        <div class="link-description">${link.description || ''}</div>
                    </div>
                </div>
                <div class="link-actions">
                    <button class="edit-button" onclick="editLink('${link.id}', '${link.title}', '${link.url}', '${link.description || ''}')">编辑</button>
                    <button class="delete-button" onclick="deleteLink('${encodeURIComponent(link.id)}')">删除</button>
                </div>
            `;
            return linkItem;
        }

        // 加载指定分类的链接
        async function loadLinks(category = 'all') {
            await filterLinksByCategory(category);
        }

        // 导入链接
        let isImporting = false;
        async function importLinks() {
            if (isImporting) {
                showToast('正在导入链接，请稍候...', 'info');
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    isImporting = true;
                    // 禁用所有工具箱按钮
                    const toolButtons = document.querySelectorAll('.action-button');
                    toolButtons.forEach(btn => {
                        btn.disabled = true;
                        btn.style.backgroundColor = '#ccc';
                        btn.style.cursor = 'not-allowed';
                    });
                    // 显示导入中的提示
                    showToast('正在导入链接，请稍候...', 'info');

                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const links = JSON.parse(event.target.result);
                        const response = await fetch(`${baseUrl}/api/import`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ links })
                        });
                            
                        if (response.ok) {
                                // 等待所有重新加载操作完成
                                try {
                                    // 重新加载分类
                            await loadCategories();
                                    // 更新侧边栏导航
                                    await updateSidebarNav();
                                    // 重新加载所有链接
                                    await loadLinks('all');
                                    // 切换到"显示所有分类"视图
                                    const allCategoriesHeader = document.querySelector('#categoryNav li:first-child .category-nav-header');
                                    if (allCategoriesHeader) {
                                        allCategoriesHeader.click();
                                    }

                                    // 创建导入结果对话框
                                    const resultDialog = document.createElement('div');
                                    resultDialog.className = 'confirm-dialog-overlay';
                                    resultDialog.style.display = 'flex';
                                    resultDialog.innerHTML = `
                                        <div class="confirm-dialog" style="background: #2c3e50; color: white;">
                                            <div class="confirm-dialog-title" style="color: white; font-size: 22px; border-bottom: 2px solid #34495e; padding-bottom: 15px;">导入结果</div>
                                            <div class="confirm-dialog-content" style="padding: 20px 0;">
                                                <p style="font-size: 18px; color: white; margin-bottom: 20px;">导入成功！</p>
                                                <div style="display: grid; grid-template-columns: auto auto; gap: 10px; margin-bottom: 20px;">
                                                    <div style="text-align: right; color: #bdc3c7;">导入链接数量:</div>
                                                    <div style="color: #2ecc71;">${links.length}</div>
                                                    <div style="text-align: right; color: #bdc3c7;">导入分类:</div>
                                                    <div style="color: #2ecc71;">${[...new Set(links.map(link => link.category))].join(', ')}</div>
                                                </div>
                                            </div>
                                            <div class="confirm-dialog-buttons" style="border-top: 2px solid #34495e; padding-top: 15px;">
                                                <button class="confirm-dialog-button confirm-dialog-confirm" style="background: #3498db;" onclick="this.closest('.confirm-dialog-overlay').remove()">确定</button>
                                            </div>
                                        </div>
                                    `;
                                    document.body.appendChild(resultDialog);
                                } catch (reloadError) {
                                    console.error('重新加载数据失败:', reloadError);
                                    showToast('导入成功，但重新加载数据失败，请刷新页面', 'error');
                                }
                        } else {
                            throw new Error('服务器响应错误');
                        }
                    } catch (error) {
                        console.error('导入链接失败:', error);
                            showToast('导入链接失败，请确保文件格式正确', 'error');
                    }
                };
                reader.readAsText(file);
                } catch (error) {
                    console.error('导入链接失败:', error);
                    showToast('导入链接失败: ' + error.message, 'error');
                } finally {
                    isImporting = false;
                    // 恢复所有工具箱按钮
                    const toolButtons = document.querySelectorAll('.action-button');
                    toolButtons.forEach(btn => {
                        btn.disabled = false;
                        btn.style.backgroundColor = '';
                        btn.style.cursor = 'pointer';
                    });
                }
            };
            input.click();
        }

        // 导出链接
        let isExporting = false;
        async function exportLinks() {
            if (isExporting) {
                showToast('正在导出链接，请稍候...', 'info');
                return;
            }

            try {
                isExporting = true;
                // 禁用所有工具箱按钮
                const toolButtons = document.querySelectorAll('.action-button');
                toolButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.backgroundColor = '#ccc';
                    btn.style.cursor = 'not-allowed';
                });
                // 显示导出中的提示
                showToast('正在导出链接，请稍候...', 'info');

                const response = await fetch(`${baseUrl}/api/export`);
                if (!response.ok) {
                    throw new Error('导出失败');
                }
                const links = await response.json();
                const blob = new Blob([JSON.stringify(links, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'links.json';
                a.click();
                URL.revokeObjectURL(url);
                showToast('链接导出成功！');
            } catch (error) {
                console.error('导出链接失败:', error);
                showToast('导出链接失败: ' + error.message, 'error');
            } finally {
                isExporting = false;
                // 恢复所有工具箱按钮
                const toolButtons = document.querySelectorAll('.action-button');
                toolButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.backgroundColor = '';
                    btn.style.cursor = 'pointer';
                });
            }
        }

        // 检查链接
        let isChecking = false;
        async function checkLinks() {
            if (isChecking) {
                showToast('正在检查链接，请稍候...', 'info');
                return;
            }

            try {
                isChecking = true;
                // 禁用所有工具箱按钮
                const toolButtons = document.querySelectorAll('.action-button');
                toolButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.backgroundColor = '#ccc';
                    btn.style.cursor = 'not-allowed';
                });
                // 显示检查中的提示
                showToast('正在检查链接，请稍候...', 'info');

                // 获取所有链接
                const response = await fetch(`${baseUrl}/api/all-links`);
                if (!response.ok) {
                    throw new Error('获取链接失败');
                }
                
                const links = await response.json();
                const results = {
                    total: links.length,
                    success: 0,
                    failed: 0,
                    failedLinks: []
                };
                
                // 创建进度对话框
                const progressDialog = document.createElement('div');
                progressDialog.className = 'confirm-dialog-overlay';
                progressDialog.style.display = 'flex';
                progressDialog.innerHTML = `
                    <div class="confirm-dialog" style="background: #2c3e50; color: white; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
                        <div class="confirm-dialog-title" style="color: white; font-size: 22px; border-bottom: 2px solid #34495e; padding-bottom: 15px;">检查链接进度</div>
                        <div class="confirm-dialog-content" style="padding: 20px 0;">
                            <div id="checkProgress" style="font-size: 16px; color: white; margin-bottom: 15px;">正在检查: 0/${links.length}</div>
                            <div id="checkResults" style="font-size: 16px; color: white;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>成功:</span>
                                    <span style="color: #2ecc71">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>失败:</span>
                                    <span style="color: #e74c3c">0</span>
                                </div>
                            </div>
                            <div style="width: 100%; height: 4px; background: #34495e; margin-top: 20px; border-radius: 2px;">
                                <div id="progressBar" style="width: 0%; height: 100%; background: #3498db; border-radius: 2px; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(progressDialog);
                
                // 更新进度显示
                const progressElement = document.getElementById('checkProgress');
                const resultsElement = document.getElementById('checkResults');
                const progressBar = document.getElementById('progressBar');
                
                // 并发检查链接
                const checkPromises = links.map(async (link, index) => {
                    try {
                        const response = await fetch(link.url, { method: 'HEAD', mode: 'no-cors' });
                        results.success++;
                    } catch (error) {
                        results.failed++;
                        results.failedLinks.push({
                            title: link.title,
                            url: link.url,
                            error: error.message
                        });
                    }
                    
                    // 更新进度
                    const progress = ((index + 1) / links.length) * 100;
                    progressElement.textContent = `正在检查: ${index + 1}/${links.length}`;
                    progressBar.style.width = `${progress}%`;
                    resultsElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>成功:</span>
                            <span style="color: #2ecc71">${results.success}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>失败:</span>
                            <span style="color: #e74c3c">${results.failed}</span>
                        </div>
                    `;
                });
                
                // 等待所有检查完成
                await Promise.all(checkPromises);
                
                // 显示最终结果
                progressDialog.remove();
                
                if (results.failed > 0) {
                    // 创建结果对话框
                    const resultDialog = document.createElement('div');
                    resultDialog.className = 'confirm-dialog-overlay';
                    resultDialog.style.display = 'flex';
                    resultDialog.innerHTML = `
                        <div class="confirm-dialog" style="background: #2c3e50; color: white;">
                            <div class="confirm-dialog-title" style="color: white; font-size: 22px; border-bottom: 2px solid #34495e; padding-bottom: 15px;">链接检查结果</div>
                            <div class="confirm-dialog-content" style="max-height: 70vh; overflow-y: auto;">
                                <div style="padding: 20px 0;">
                                    <p style="font-size: 18px; color: white; margin-bottom: 20px;">检查完成！</p>
                                    <div style="display: grid; grid-template-columns: auto auto; gap: 10px; margin-bottom: 20px;">
                                        <div style="text-align: right; color: #bdc3c7;">总计:</div>
                                        <div style="color: white;">${results.total}</div>
                                        <div style="text-align: right; color: #bdc3c7;">成功:</div>
                                        <div style="color: #2ecc71;">${results.success}</div>
                                        <div style="text-align: right; color: #bdc3c7;">失败:</div>
                                        <div style="color: #e74c3c;">${results.failed}</div>
                                    </div>
                                    <div style="margin-top: 20px;">
                                        <p style="font-size: 16px; color: white; margin-bottom: 15px;">失败的链接：</p>
                                        ${results.failedLinks.map(link => `
                                            <div style="background: #34495e; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                                <p style="color: white; font-weight: 500; margin-bottom: 5px;">${link.title}</p>
                                                <a href="${link.url}" target="_blank" style="color: #3498db; text-decoration: none; word-break: break-all;">${link.url}</a>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            <div class="confirm-dialog-buttons" style="border-top: 2px solid #34495e; padding-top: 15px;">
                                <button class="confirm-dialog-button confirm-dialog-confirm" style="background: #3498db;" onclick="this.closest('.confirm-dialog-overlay').remove()">关闭</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(resultDialog);
                } else {
                    showToast('所有链接检查完成，全部可用！', 'success');
                }
            } catch (error) {
                console.error('检查链接失败:', error);
                showToast('检查链接失败: ' + error.message, 'error');
            } finally {
                isChecking = false;
                // 恢复所有工具箱按钮
                const toolButtons = document.querySelectorAll('.action-button');
                toolButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.backgroundColor = '';
                    btn.style.cursor = 'pointer';
                });
            }
        }

        // 编辑分类
        async function editCategory(oldCategory) {
            console.log('开始编辑分类:', oldCategory);
            const newCategory = prompt('请输入新的分类名称:', oldCategory);
            if (!newCategory) {
                showToast('分类名称不能为空', 'error');
                return;
            }
            
            if (newCategory === oldCategory) {
                showToast('新分类名称与原分类名称相同', 'info');
                return;
            }

            try {
                console.log('发送更新分类请求:', { oldCategory, newCategory });
                const response = await fetch(`${baseUrl}/api/categories/${encodeURIComponent(oldCategory)}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ newCategory })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || '更新分类失败');
                }

                await loadCategories();
                await updateSidebarNav();
                await loadLinks('all');
                showToast(data.message || '分类更新成功！');
            } catch (error) {
                console.error('更新分类失败:', error);
                showToast('更新分类失败: ' + error.message, 'error');
            }
        }

        // 删除分类
        async function deleteCategory(category) {
            showConfirmDialog(`确定要删除分类"${category}"及其所有链接吗？`, async () => {
            try {
                const response = await fetch(`${baseUrl}/api/categories/${encodeURIComponent(category)}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('删除分类失败');
                }

                await loadCategories();
                await updateSidebarNav();
                await loadLinks('all');
                showToast('分类删除成功！');
            } catch (error) {
                console.error('删除分类失败:', error);
                showToast('删除分类失败: ' + error.message, 'error');
            }
            });
        }

        // 编辑链接
        async function editLink(id, title, url, description) {
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            
            overlay.innerHTML = `
                <div class="edit-dialog">
                    <div class="edit-dialog-title">编辑链接</div>
                    <div class="edit-form-group">
                        <label for="editTitle">网站名称</label>
                        <input type="text" id="editTitle" value="${title}">
                    </div>
                    <div class="edit-form-group">
                        <label for="editUrl">网站地址</label>
                        <input type="url" id="editUrl" value="${url}">
                    </div>
                    <div class="edit-form-group">
                        <label for="editDescription">简短描述</label>
                        <input type="text" id="editDescription" value="${description}">
                    </div>
                    <div class="edit-dialog-buttons">
                        <button class="edit-dialog-button edit-dialog-cancel" onclick="this.closest('.edit-dialog-overlay').remove()">取消</button>
                        <button class="edit-dialog-button edit-dialog-confirm" onclick="updateLink('${id}')">保存</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }

        // 更新链接
        async function updateLink(id) {
            const title = document.getElementById('editTitle').value.trim();
            const url = document.getElementById('editUrl').value.trim();
            const description = document.getElementById('editDescription').value.trim();

            if (!title || !url) {
                showToast('网站名称和地址不能为空', 'error');
                return;
            }

            try {
                const response = await fetch(`${baseUrl}/api/links/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, url, description })
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || '更新失败');
                }

                // 关闭编辑对话框
                document.querySelector('.edit-dialog-overlay').remove();

                // 获取当前选中的分类
                const selectedOption = document.querySelector('.category-filter .selected-option');
                const currentCategory = selectedOption.getAttribute('data-value') || 'all';

                // 重新加载链接
                await loadLinks(currentCategory);
                showToast('链接更新成功！');
            } catch (error) {
                console.error('更新链接失败:', error);
                showToast('更新链接失败: ' + error.message, 'error');
            }
        }

        // 侧边栏收缩功能
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const body = document.body;
            const toggle = document.querySelector('.sidebar-toggle i');
            
            if (!sidebar || !body || !toggle) return;
            
            sidebar.classList.toggle('collapsed');
            body.classList.toggle('sidebar-collapsed');
            
            document.documentElement.style.setProperty(
                '--sidebar-width',
                sidebar.classList.contains('collapsed') ? '60px' : '250px'
            );
            
            toggle.style.transform = sidebar.classList.contains('collapsed') 
                ? 'rotate(-45deg)' 
                : 'rotate(135deg)';
        }

        // 初始化箭头方向
        document.addEventListener('DOMContentLoaded', () => {
            const toggle = document.querySelector('.sidebar-toggle i');
            if (toggle) {
                toggle.style.transform = 'rotate(135deg)';
            }
        });

        // 更新侧边栏导航
        async function updateSidebarNav() {
            const nav = document.getElementById('categoryNav');
            nav.innerHTML = '';

            const categoryElements = new Map();

            try {
                // 添加笔记导航
                const notesLi = document.createElement('li');
                notesLi.className = 'category-nav-item';
                notesLi.innerHTML = `
                    <div class="category-nav-header">
                        <span class="category-nav-toggle">▶</span>
                        <span class="category-name">我的笔记</span>
                    </div>
                    <div class="category-nav-links"></div>
                `;

                const notesHeader = notesLi.querySelector('.category-nav-header');
                const notesToggle = notesLi.querySelector('.category-nav-toggle');
                const notesLinks = notesLi.querySelector('.category-nav-links');
                let notesLoaded = false;

                notesHeader.addEventListener('click', async () => {
                    // 移除所有分类的active类
                    nav.querySelectorAll('.category-nav-header').forEach(h => {
                        h.classList.remove('active');
                    });
                    // 添加active类到"我的笔记"
                    notesHeader.classList.add('active');

                    if (currentExpandedCategory === 'notes') {
                        notesToggle.classList.remove('expanded');
                        notesLinks.classList.remove('expanded');
                        currentExpandedCategory = null;
                        return;
                    }

                    if (currentExpandedCategory) {
                        const prevElement = categoryElements.get(currentExpandedCategory);
                        if (prevElement) {
                            prevElement.toggle.classList.remove('expanded');
                            prevElement.links.classList.remove('expanded');
                        }
                    }

                    notesToggle.classList.add('expanded');
                    notesLinks.classList.add('expanded');
                    currentExpandedCategory = 'notes';

                    if (!notesLoaded) {
                        try {
                            const response = await fetch(`${baseUrl}/api/notes`);
                            if (!response.ok) throw new Error('获取笔记失败');
                            
                            const notes = await response.json();
                            notesLinks.innerHTML = notes.map(note => `
                                <a href="#" class="category-nav-link" onclick="showNoteDetail(${note.id}); return false;" title="${note.content}">
                                    ${note.title}
                                </a>
                            `).join('');
                            
                            notesLoaded = true;
                        } catch (error) {
                            console.error('加载笔记列表失败:', error);
                            showToast('加载笔记列表失败', 'error');
                        }
                    }
                });

                nav.appendChild(notesLi);

                const divider = document.createElement('div');
                divider.className = 'category-nav-divider';
                nav.appendChild(divider);

                // 添加"全部分类"选项
                const allCategoriesLi = document.createElement('li');
                allCategoriesLi.className = 'category-nav-item';
                allCategoriesLi.innerHTML = `
                    <div class="category-nav-header active">
                        <span>全部分类</span>
                    </div>
                `;

                const allCategoriesHeader = allCategoriesLi.querySelector('.category-nav-header');

                allCategoriesHeader.addEventListener('click', async () => {
                    // 移除所有分类的active类，包括"全部分类"
                    nav.querySelectorAll('.category-nav-header').forEach(h => {
                        h.classList.remove('active');
                    });
                    allCategoriesHeader.classList.add('active');

                    // 更新分类筛选器的选中状态
                    const filterSelect = document.querySelector('.category-filter .selected-option');
                    const filterItems = document.querySelectorAll('.category-filter .dropdown-item');
                    
                    // 更新筛选器的显示文本和值
                    filterSelect.textContent = '显示所有分类';
                    filterSelect.setAttribute('data-value', 'all');
                    
                    // 更新筛选器选项的选中状态
                    filterItems.forEach(item => {
                        item.classList.remove('selected');
                        if (item.getAttribute('data-value') === 'all') {
                            item.classList.add('selected');
                        }
                    });

                    if (currentExpandedCategory) {
                        const element = categoryElements.get(currentExpandedCategory);
                        if (element) {
                            element.toggle.classList.remove('expanded');
                            element.links.classList.remove('expanded');
                        }
                        currentExpandedCategory = null;
                    }

                    await filterLinksByCategory('all');
                    scrollToTop();
                });

                nav.appendChild(allCategoriesLi);

                const response = await fetch(`${baseUrl}/api/categories?sort=${isCategoryDescSort ? 'desc' : 'asc'}`);
                if (!response.ok) throw new Error('获取分类失败');
                const categories = await response.json();

                for (const category of categories) {
                    const li = document.createElement('li');
                    li.className = 'category-nav-item';
                    li.innerHTML = `
                        <div class="category-nav-header">
                            <span class="category-nav-toggle">▶</span>
                            <span class="category-name">${category}</span>
                        </div>
                        <div class="category-nav-links"></div>
                    `;

                    const header = li.querySelector('.category-nav-header');
                    const toggle = li.querySelector('.category-nav-toggle');
                    const links = li.querySelector('.category-nav-links');
                    let linksLoaded = false;

                    categoryElements.set(category, { header, toggle, links, li });

                    header.addEventListener('click', async () => {
                        // 移除所有分类的active类，包括"全部分类"
                        nav.querySelectorAll('.category-nav-header').forEach(h => {
                            h.classList.remove('active');
                        });
                        header.classList.add('active');

                        // 更新分类筛选器的选中状态
                        const categoryName = header.querySelector('.category-name').textContent;
                        const filterSelect = document.querySelector('.category-filter .selected-option');
                        const filterItems = document.querySelectorAll('.category-filter .dropdown-item');
                        
                        // 更新筛选器的显示文本和值
                        filterSelect.textContent = categoryName;
                        filterSelect.setAttribute('data-value', categoryName);
                        
                        // 更新筛选器选项的选中状态
                        filterItems.forEach(item => {
                            item.classList.remove('selected');
                            if (item.getAttribute('data-value') === categoryName) {
                                item.classList.add('selected');
                            }
                        });

                        if (currentExpandedCategory === category) {
                            toggle.classList.remove('expanded');
                            links.classList.remove('expanded');
                            currentExpandedCategory = null;
                            
                            await loadLinks(category);
                            scrollToTop();
                            return;
                        }

                        if (currentExpandedCategory) {
                            const prevElement = categoryElements.get(currentExpandedCategory);
                            if (prevElement) {
                                prevElement.toggle.classList.remove('expanded');
                                prevElement.links.classList.remove('expanded');
                            }
                        }

                        toggle.classList.add('expanded');
                        links.classList.add('expanded');
                        currentExpandedCategory = category;

                        if (!linksLoaded) {
                            try {
                                const linksResponse = await fetch(`${baseUrl}/api/links/${encodeURIComponent(category)}`);
                                if (!linksResponse.ok) throw new Error('获取链接失败');
                                
                                const categoryLinks = await linksResponse.json();
                                links.innerHTML = categoryLinks.map(link => `
                                    <a href="${link.url}" class="category-nav-link" target="_blank" title="${link.description || ''}">
                                        ${link.title}
                                    </a>
                                `).join('');
                                
                                linksLoaded = true;
                            } catch (error) {
                                console.error('加载分类链接失败:', error);
                                showToast('加载分类链接失败', 'error');
                            }
                        }

                        await loadLinks(category);
                        scrollToTop();
                    });

                    nav.appendChild(li);
                }
            } catch (error) {
                console.error('加载分类导航失败:', error);
                showToast('加载分类导航失败: ' + error.message, 'error');
            }
        }

        // 添加确认对话框相关函数
        let confirmCallback = null;

        function showConfirmDialog(message, callback) {
            const dialog = document.getElementById('confirmDialog');
            const content = dialog.querySelector('.confirm-dialog-content');
            content.textContent = message;
            dialog.style.display = 'flex';
            confirmCallback = callback;
        }

        function closeConfirmDialog() {
            const dialog = document.getElementById('confirmDialog');
            dialog.style.display = 'none';
            confirmCallback = null;
        }

        function handleConfirm() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmDialog();
        }

        // 添加自定义下拉框相关函数
        function toggleDropdown(event) {
            const select = event.currentTarget;
            select.classList.toggle('open');
            
            // 点击外部关闭下拉框
            if (select.classList.contains('open')) {
                document.addEventListener('click', function closeDropdown(e) {
                    if (!select.contains(e.target)) {
                        select.classList.remove('open');
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }
        }

        // 导出模板
        function exportTemplate() {
            // 显示说明对话框
            const instructionDialog = document.createElement('div');
            instructionDialog.className = 'confirm-dialog-overlay';
            instructionDialog.style.display = 'flex';
            instructionDialog.innerHTML = `
                <div class="confirm-dialog">
                    <div class="confirm-dialog-title">导入文件格式说明</div>
                    <div class="confirm-dialog-content">
                        <p style="margin-bottom: 15px;">JSON文件格式要求：</p>
                        <ol style="list-style-type: decimal; padding-left: 20px;">
                            <li style="margin-bottom: 10px;">文件必须是一个数组，包含多个链接对象</li>
                            <li style="margin-bottom: 10px;">每个链接对象必须包含以下字段：
                                <ul style="list-style-type: disc; padding-left: 20px; margin-top: 5px;">
                                    <li>category: 分类名称</li>
                                    <li>title: 网站名称</li>
                                    <li>url: 网站地址（支持 http:// 或 https:// 开头）</li>
                                    <li>description: 网站描述（可选字段）</li>
                                </ul>
                            </li>
                        </ol>
                        <p style="margin-top: 15px;">点击确定下载示例文件</p>
                    </div>
                    <div class="confirm-dialog-buttons">
                        <button class="confirm-dialog-button confirm-dialog-cancel" onclick="this.closest('.confirm-dialog-overlay').remove()">取消</button>
                        <button class="confirm-dialog-button confirm-dialog-confirm" onclick="downloadTemplate(this)">确定</button>
                    </div>
                </div>
            `;
            document.body.appendChild(instructionDialog);
        }

        // 下载模板文件
        function downloadTemplate(button) {
            const template = [
                {
                    "category": "示例分类",
                    "title": "示例网站名称",
                    "url": "https://example.com",
                    "description": "这是一个示例描述（可选）"
                },
                {
                    "category": "示例分类2",
                    "title": "示例网站2",
                    "url": "https://example2.com",
                    "description": "这是另一个示例描述"
                }
            ];

            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'links_template.json';
            a.click();
            URL.revokeObjectURL(url);
            button.closest('.confirm-dialog-overlay').remove();
            showToast('示例文件下载成功！');
        }

        // 笔记管理
        const noteManager = {
            isSubmitting: false,

            async addNote() {
                if (this.isSubmitting) {
                    utils.showToast('请等待当前操作完成', 'info');
                    return;
                }

                const title = document.getElementById('noteTitle').value;
                const content = document.getElementById('noteContent').value;
                const tags = document.getElementById('noteTags').value;

                if (!title || !content) {
                    utils.showToast('标题和内容为必填项', 'error');
                    return;
                }

                this.isSubmitting = true;
                utils.showToast('正在添加笔记...', 'info');

                try {
                    const response = await fetch(`${baseUrl}/api/notes`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ title, content, tags })
                    });

                    if (!response.ok) {
                        throw new Error('添加笔记失败');
                    }

                    // 清空表单
                    this.clearNoteForm();
                    
                    // 重新加载笔记列表
                    await this.loadNotes();
                    
                    // 更新左侧导航栏的笔记列表
                    const notesLinks = document.querySelector('.category-nav-item .category-nav-links');
                    if (notesLinks) {
                        const response = await fetch(`${baseUrl}/api/notes`);
                        if (!response.ok) throw new Error('获取笔记列表失败');
                        
                        const notes = await response.json();
                        const escapeHtml = (text) => {
                            const div = document.createElement('div');
                            div.textContent = text;
                            return div.innerHTML;
                        };
                        
                        notesLinks.innerHTML = notes.map(note => `
                            <a href="#" class="category-nav-link" onclick="showNoteDetail(${note.id}); return false;" title="${escapeHtml(note.content)}">
                                ${escapeHtml(note.title)}
                            </a>
                        `).join('');
                    }

                    utils.showToast('笔记添加成功！', 'success');
                } catch (error) {
                    console.error('添加笔记失败:', error);
                    utils.showToast('添加笔记失败', 'error');
                } finally {
                    this.isSubmitting = false;
                }
            },

            async loadNotes() {
                try {
                    const response = await fetch(`${baseUrl}/api/notes`);
                    if (!response.ok) {
                        throw new Error('获取笔记失败');
                    }

                    const notes = await response.json();
                    this.renderNotes(notes);
                } catch (error) {
                    console.error('加载笔记失败:', error);
                    utils.showToast('加载笔记失败', 'error');
                }
            },

            async deleteNote(id) {
                // 显示自定义确认对话框
                const confirmDialog = document.getElementById('confirmDialog');
                const confirmContent = confirmDialog.querySelector('.confirm-dialog-content');
                confirmContent.textContent = '确定要删除这个笔记吗？';
                confirmDialog.style.display = 'flex';

                // 设置确认按钮的点击事件
                const confirmBtn = confirmDialog.querySelector('.confirm-dialog-confirm');
                const originalOnClick = confirmBtn.onclick;
                confirmBtn.onclick = async () => {
                    try {
                        const response = await fetch(`${baseUrl}/api/notes/${id}`, {
                            method: 'DELETE'
                        });

                        if (!response.ok) {
                            throw new Error('删除笔记失败');
                        }

                        utils.showToast('笔记删除成功', 'success');
                        
                        // 重新加载笔记列表
                        await this.loadNotes();
                        
                        // 更新左侧导航栏的笔记列表
                        const notesLinks = document.querySelector('.category-nav-item .category-nav-links');
                        if (notesLinks) {
                            const response = await fetch(`${baseUrl}/api/notes`);
                            if (!response.ok) throw new Error('获取笔记列表失败');
                            
                            const notes = await response.json();
                            const escapeHtml = (text) => {
                                const div = document.createElement('div');
                                div.textContent = text;
                                return div.innerHTML;
                            };
                            
                            notesLinks.innerHTML = notes.map(note => `
                                <a href="#" class="category-nav-link" onclick="showNoteDetail(${note.id}); return false;" title="${escapeHtml(note.content)}">
                                    ${escapeHtml(note.title)}
                                </a>
                            `).join('');
                        }
                    } catch (error) {
                        console.error('删除笔记失败:', error);
                        utils.showToast('删除笔记失败', 'error');
                    } finally {
                        // 恢复确认按钮的原始事件处理程序
                        confirmBtn.onclick = originalOnClick;
                        // 关闭对话框
                        confirmDialog.style.display = 'none';
                    }
                };

                // 设置取消按钮的点击事件
                const cancelBtn = confirmDialog.querySelector('.confirm-dialog-cancel');
                cancelBtn.onclick = () => {
                    // 恢复确认按钮的原始事件处理程序
                    confirmBtn.onclick = originalOnClick;
                    // 关闭对话框
                    confirmDialog.style.display = 'none';
                };
            },

            async editNote(id) {
                try {
                    const response = await fetch(`${baseUrl}/api/notes/${id}`);
                    if (!response.ok) {
                        throw new Error('获取笔记失败');
                    }

                    const note = await response.json();
                    document.getElementById('noteTitle').value = note.title;
                    document.getElementById('noteContent').value = note.content;
                    document.getElementById('noteTags').value = note.tags || '';

                    // 将表单滚动到可见位置
                    document.querySelector('.note-form').scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    console.error('加载笔记失败:', error);
                    utils.showToast('加载笔记失败', 'error');
                }
            },

            renderNotes(notes) {
                const notesList = document.getElementById('notesList');
                notesList.innerHTML = notes.map(note => {
                    // 添加HTML转义函数
                    const escapeHtml = (text) => {
                        const div = document.createElement('div');
                        div.textContent = text;
                        return div.innerHTML;
                    };
                    
                    // 根据内容长度判断类名
                    const contentLength = note.content.length;
                    const cardClass = contentLength > 200 ? 'note-card long-content' : 'note-card short-content';
                    
                    return `
                    <div class="${cardClass}" data-note-id="${note.id}">
                        <h3>${escapeHtml(note.title)}</h3>
                        <div class="note-content">${escapeHtml(note.content)}</div>
                        ${note.tags ? `<div class="note-tags">标签: ${escapeHtml(note.tags)}</div>` : ''}
                        <div class="note-actions">
                            <button class="edit-note" onclick="editNoteDialog(${note.id}, '${escapeHtml(note.title).replace(/'/g, "\\'")}', '${escapeHtml(note.content).replace(/'/g, "\\'")}', '${escapeHtml(note.tags || '').replace(/'/g, "\\'")}')">编辑</button>
                            <button class="delete-note" onclick="noteManager.deleteNote(${note.id})">删除</button>
                        </div>
                    </div>
                    `;
                }).join('');
            },

            clearNoteForm() {
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').value = '';
                document.getElementById('noteTags').value = '';
            }
        };

        function showNotes() {
            // 隐藏链接相关内容
            document.getElementById('linksContainer').style.display = 'none';
            document.getElementById('linkTools').style.display = 'none';
            
            // 显示笔记相关内容
            document.getElementById('notesContainer').style.display = 'block';
            document.getElementById('noteTools').style.display = 'block';
            
            // 更新导航栏状态
            document.querySelector('.nav-links a.active').classList.remove('active');
            document.querySelector('.nav-links a:nth-child(2)').classList.add('active');

            // 保持导航栏可见，但只显示笔记相关内容
            const categoryNav = document.getElementById('categoryNav');
            categoryNav.style.display = 'block';
            
            // 显示笔记导航项，隐藏其他导航项
            categoryNav.querySelectorAll('.category-nav-item').forEach(item => {
                const categoryName = item.querySelector('.category-name');
                if (categoryName && categoryName.textContent.includes('我的笔记')) {
                    item.style.display = 'block';  // 显示笔记导航项
                    // 移除其他项的active类
                    categoryNav.querySelectorAll('.category-nav-header').forEach(h => {
                        h.classList.remove('active');
                    });
                    // 添加active类到"我的笔记"
                    const notesHeader = item.querySelector('.category-nav-header');
                    if (notesHeader) {
                        notesHeader.classList.add('active');
                        // 自动展开"我的笔记"
                        const toggle = item.querySelector('.category-nav-toggle');
                        const links = item.querySelector('.category-nav-links');
                        if (toggle && links) {
                            // 先移除所有展开状态
                            toggle.classList.remove('expanded');
                            links.classList.remove('expanded');
                            links.style.display = 'none';
                            
                            // 延迟一帧后添加展开状态
                            requestAnimationFrame(() => {
                                toggle.classList.add('expanded');
                                links.classList.add('expanded');
                                links.style.display = 'block';
                                currentExpandedCategory = 'notes';
                                
                                // 加载笔记列表
                                fetch(`${baseUrl}/api/notes`)
                                    .then(response => response.json())
                                    .then(notes => {
                                        const escapeHtml = (text) => {
                                            const div = document.createElement('div');
                                            div.textContent = text;
                                            return div.innerHTML;
                                        };
                                        links.innerHTML = notes.map(note => `
                                            <a href="#" class="category-nav-link" onclick="showNoteDetail(${note.id}); return false;" title="${escapeHtml(note.content)}">
                                                ${escapeHtml(note.title)}
                                            </a>
                                        `).join('');
                                    })
                                    .catch(error => {
                                        console.error('加载笔记列表失败:', error);
                                        showToast('加载笔记列表失败', 'error');
                                    });
                            });
                        }
                    }
                } else {
                    item.style.display = 'none';
                }
            });
            
            // 加载所有笔记
            noteManager.loadNotes();
        }

        function showLinks() {
            // 显示链接相关内容
            document.getElementById('linksContainer').style.display = 'block';
            document.getElementById('linkTools').style.display = 'block';
            
            // 隐藏笔记相关内容
            document.getElementById('notesContainer').style.display = 'none';
            document.getElementById('noteTools').style.display = 'none';
            
            // 更新导航栏状态
            document.querySelector('.nav-links a.active').classList.remove('active');
            document.querySelector('.nav-links a:first-child').classList.add('active');

            // 显示所有导航项，但隐藏笔记相关项
            const categoryNav = document.getElementById('categoryNav');
            categoryNav.style.display = 'block';
            categoryNav.querySelectorAll('.category-nav-item').forEach(item => {
                const categoryName = item.querySelector('.category-name');
                if (categoryName && categoryName.textContent.includes('我的笔记')) {
                    item.style.display = 'none';
                } else {
                    item.style.display = 'block';
                }
            });
            
            // 隐藏第一个分隔线（笔记下方的分隔线）
            const firstDivider = categoryNav.querySelector('.category-nav-divider');
            if (firstDivider) {
                firstDivider.style.display = 'none';
            }

            // 确保"全部分类"保持选中状态
            const allCategoriesHeader = Array.from(categoryNav.querySelectorAll('.category-nav-header'))
                .find(header => header.textContent.includes('全部分类'));
            if (allCategoriesHeader) {
                // 移除其他项的active类
                categoryNav.querySelectorAll('.category-nav-header').forEach(header => {
                    if (header !== allCategoriesHeader && !header.querySelector('.category-name')?.textContent.includes('我的笔记')) {
                        header.classList.remove('active');
                    }
                });
                allCategoriesHeader.classList.add('active');
            }
            
            // 加载链接列表
            loadLinks('all');
        }

        // 修改笔记搜索功能
        function searchNotes() {
            const searchText = document.getElementById('noteSearchInput').value.toLowerCase();
            const searchType = document.querySelector('input[name="search-type"]:checked').value;
            
            // 根据搜索类型更新placeholder
            const searchInput = document.getElementById('noteSearchInput');
            searchInput.placeholder = searchType === 'content' ? '搜索笔记内容...' : '搜索标签，多个标签用逗号分隔...';
            
            noteManager.searchNotes(searchText, searchType);
        }

        // 扩展笔记管理器功能
        Object.assign(noteManager, {
            async searchNotes(searchText, searchType = 'content') {
                try {
                    const response = await fetch(`${baseUrl}/api/notes/search?q=${encodeURIComponent(searchText)}&type=${searchType}`);
                    if (!response.ok) {
                        throw new Error('搜索笔记失败');
                    }
                    const notes = await response.json();
                    
                    // 如果是标签搜索，对结果进行标签高亮处理
                    if (searchType === 'tag' && searchText) {
                        const searchTags = searchText.split(',').map(tag => tag.trim().toLowerCase());
                        notes.forEach(note => {
                            if (note.tags) {
                                const noteTags = note.tags.split(',').map(tag => tag.trim());
                                note.tags = noteTags.map(tag => {
                                    if (searchTags.includes(tag.toLowerCase())) {
                                        return `<span class="highlighted-tag">${tag}</span>`;
                                    }
                                    return tag;
                                }).join(', ');
                            }
                        });
                    }
                    
                    this.renderNotes(notes);
                    
                    // 显示搜索结果统计
                    const resultCount = notes.length;
                    utils.showToast(`找到 ${resultCount} 个${searchType === 'tag' ? '标签匹配的' : ''}笔记`);
                } catch (error) {
                    console.error('搜索笔记失败:', error);
                    utils.showToast('搜索笔记失败', 'error');
                }
            },

            async exportNotes() {
                try {
                    const response = await fetch(`${baseUrl}/api/notes/export`);
                    if (!response.ok) {
                        throw new Error('导出笔记失败');
                    }
                    const notes = await response.json();
                    const blob = new Blob([JSON.stringify(notes, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'notes.json';
                    a.click();
                    URL.revokeObjectURL(url);
                    utils.showToast('笔记导出成功');
                } catch (error) {
                    console.error('导出笔记失败:', error);
                    utils.showToast('导出笔记失败', 'error');
                }
            },

            async importNotes() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    try {
                        const reader = new FileReader();
                        reader.onload = async (event) => {
                            const notes = JSON.parse(event.target.result);
                            const response = await fetch(`${baseUrl}/api/notes/import`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ notes })
                            });

                            if (!response.ok) {
                                throw new Error('导入笔记失败');
                            }

                            await this.loadNotes();
                            utils.showToast('笔记导入成功');
                        };
                        reader.readAsText(file);
                    } catch (error) {
                        console.error('导入笔记失败:', error);
                        utils.showToast('导入笔记失败', 'error');
                    }
                };
                input.click();
            }
        });

        // 添加笔记编辑对话框函数
        function editNoteDialog(id, title, content, tags) {
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            
            overlay.innerHTML = `
                <div class="edit-dialog">
                    <div class="edit-dialog-title">编辑笔记</div>
                    <div class="edit-form-group">
                        <label for="editNoteTitle">笔记标题</label>
                        <input type="text" id="editNoteTitle" value="${title}">
                    </div>
                    <div class="edit-form-group">
                        <label for="editNoteContent">笔记内容</label>
                        <textarea id="editNoteContent" style="min-height: 150px;">${content}</textarea>
                    </div>
                    <div class="edit-form-group">
                        <label for="editNoteTags">标签</label>
                        <input type="text" id="editNoteTags" value="${tags}" placeholder="用逗号分隔多个标签">
                    </div>
                    <div class="edit-dialog-buttons">
                        <button class="edit-dialog-button edit-dialog-cancel" onclick="this.closest('.edit-dialog-overlay').remove()">取消</button>
                        <button class="edit-dialog-button edit-dialog-confirm" onclick="updateNote(${id})">保存</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }

        // 添加更新笔记函数
        async function updateNote(id) {
            const title = document.getElementById('editNoteTitle').value.trim();
            const content = document.getElementById('editNoteContent').value.trim();
            const tags = document.getElementById('editNoteTags').value.trim();

            if (!title || !content) {
                showToast('标题和内容不能为空', 'error');
                return;
            }

            try {
                const response = await fetch(`${baseUrl}/api/notes/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, content, tags })
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || '更新失败');
                }

                // 关闭编辑对话框
                document.querySelector('.edit-dialog-overlay').remove();

                // 重新加载笔记列表
                await noteManager.loadNotes();
                showToast('笔记更新成功！');
            } catch (error) {
                console.error('更新笔记失败:', error);
                showToast('更新笔记失败: ' + error.message, 'error');
            }
        }

        // 添加笔记详情显示函数
        async function showNoteDetail(noteId) {
            try {
                const response = await fetch(`${baseUrl}/api/notes/${noteId}`);
                if (!response.ok) throw new Error('获取笔记详情失败');
                
                const note = await response.json();
                
                // 切换到笔记视图
                showNotes();
                
                // 滚动到对应的笔记卡片
                const noteCard = document.querySelector(`[data-note-id="${noteId}"]`);
                if (noteCard) {
                    noteCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // 添加高亮效果
                    noteCard.style.animation = 'highlight 2s';
                }
            } catch (error) {
                console.error('获取笔记详情失败:', error);
                showToast('获取笔记详情失败', 'error');
            }
        }
    </script>
</body>
</html> 